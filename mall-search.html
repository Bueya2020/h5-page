<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>商品搜索</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/iphone16_fix.css">
    <style>
        .search-tag {
            transition: all 0.2s;
        }

        .search-tag:active {
            background-color: #1f2937;
            color: white;
        }

        .product-card {
            transition: transform 0.2s;
        }

        .product-card:active {
            transform: scale(0.98);
        }

        .filter-btn {
            transition: all 0.2s;
        }

        .filter-btn.active {
            background-color: #000;
            color: white;
        }
    </style>

    <!-- 全局错误处理和兜底方案 -->
    <script>
        (function() {
            'use strict';
            
            // 创建 Trace 对象的兜底实现
            window.Trace = window.Trace || {
                init: function() { console.log('Trace initialized (fallback)'); },
                log: function() { console.log.apply(console, arguments); },
                error: function() { console.error.apply(console, arguments); },
                warn: function() { console.warn.apply(console, arguments); },
                info: function() { console.info.apply(console, arguments); }
            };

            // 防止其他可能的调试工具错误
            window.wx = window.wx || {};
            window.my = window.my || {};
            
            // 防止 chartId 未定义错误
            window.chartId = window.chartId || 'default-chart-id';
            
            // 全局错误处理
            window.addEventListener('error', function(e) {
                console.error('Global error caught:', e.error);
                return true; // 阻止默认错误处理
            });
            
            window.addEventListener('unhandledrejection', function(e) {
                console.error('Unhandled promise rejection:', e.reason);
                e.preventDefault(); // 阻止默认处理
            });
            
            console.log('✅ 全局错误处理已初始化');
        })();
    </script>
</head>
<body class="min-h-screen w-full bg-[#000000] flex items-center justify-center font-system">
    <!-- iPhone 容器 -->
    <div class="w-full max-w-[393px] h-[852px] bg-[#1E1E1E] shadow-2xl overflow-hidden relative mx-auto rounded-[54px]">
        <!-- iPhone 状态栏 -->
        <div class="w-full h-[47px] bg-black px-5 flex items-center justify-between text-white text-[14px] font-medium">
            <div class="flex items-center space-x-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 20h.01"></path>
                    <path d="M7 20v-4"></path>
                    <path d="M12 20v-8"></path>
                    <path d="M17 20V8"></path>
                    <path d="M22 4v16"></path>
                </svg>
                <span>中国移动</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 20h.01"></path>
                    <path d="M2 8.82a15 15 0 0 1 20 0"></path>
                    <path d="M5 12.859a10 10 0 0 1 14 0"></path>
                    <path d="M8.5 16.429a5 5 0 0 1 7 0"></path>
                </svg>
            </div>
            <div class="absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2">9:41</div>
            <div class="flex items-center space-x-1">
                <span>89%</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect width="16" height="10" x="2" y="7" rx="2" ry="2"></rect>
                    <line x1="22" x2="22" y1="11" y2="13"></line>
                </svg>
            </div>
        </div>

        <!-- 动态岛 -->
        <button class="absolute left-1/2 -translate-x-1/2 bg-black transition-all duration-300 ease-out w-[126px] h-[37.5px] -top-0.5 rounded-b-[24px]"></button>

        <!-- 主内容区域 -->
        <div class="w-full h-[calc(100%-47px)] bg-white overflow-hidden relative">
            <!-- 滚动内容区域 -->
            <div class="absolute inset-0 bottom-[84px] overflow-y-auto scrollbar-none">
                <!-- 搜索栏 -->
                <header class="bg-white border-b border-gray-100 sticky top-0 z-10">
                    <div class="flex items-center space-x-3 px-4 py-3">
                        <a href="mall.html" class="text-black hover:text-gray-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m15 18-6-6 6-6"></path>
                            </svg>
                        </a>
                        <div class="flex-1 relative">
                            <input type="text" id="searchInput" name="search" placeholder="搜索商品..." class="w-full pl-10 pr-4 py-2 bg-gray-100 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-black focus:bg-white" value="智能门锁">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.3-4.3"></path>
                            </svg>

                            <!-- 清除搜索按钮 -->
                            <button id="clearSearch" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <button id="filterToggle" class="text-black hover:text-gray-600 transition-colors relative">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                            </svg>
                            <span id="activeFilterCount" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">0</span>
                        </button>
                    </div>
                </header>

                <!-- 搜索历史/热门搜索 -->
                <section id="searchHistorySection" class="px-4 py-4 bg-white">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-sm font-semibold" id="historyTitle">搜索历史</h2>
                        <button id="clearHistory" class="text-xs text-gray-500">清除历史</button>
                    </div>
                    <div id="searchTags" class="flex flex-wrap gap-2">
                        <!-- 动态生成搜索标签 -->
                    </div>
                </section>

                <!-- 筛选条件 -->
                <section class="px-4 py-3 bg-white border-t border-gray-100">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium">快速筛选</span>
                        <button id="moreFilters" class="text-xs text-blue-600">更多筛选</button>
                    </div>
                    <div class="flex items-center space-x-2 overflow-x-auto scrollbar-none">
                        <button class="quick-filter-btn active px-3 py-1 border border-gray-300 rounded-full text-sm whitespace-nowrap" data-filter="all">全部</button>
                        <button class="quick-filter-btn px-3 py-1 border border-gray-300 rounded-full text-sm whitespace-nowrap" data-filter="price-low">价格从低到高</button>
                        <button class="quick-filter-btn px-3 py-1 border border-gray-300 rounded-full text-sm whitespace-nowrap" data-filter="price-high">价格从高到低</button>
                        <button class="quick-filter-btn px-3 py-1 border border-gray-300 rounded-full text-sm whitespace-nowrap" data-filter="sales">销量优先</button>
                        <button class="quick-filter-btn px-3 py-1 border border-gray-300 rounded-full text-sm whitespace-nowrap" data-filter="rating">好评优先</button>
                        <button class="quick-filter-btn px-3 py-1 border border-gray-300 rounded-full text-sm whitespace-nowrap" data-filter="new">最新上架</button>
                    </div>

                    <!-- 活跃筛选条件显示 -->
                    <div id="activeFilters" class="mt-3 hidden">
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-500">已选择:</span>
                            <div id="activeFilterTags" class="flex flex-wrap gap-1">
                                <!-- 动态生成活跃筛选标签 -->
                            </div>
                            <button id="clearAllFilters" class="text-xs text-red-500 ml-2">清除全部</button>
                        </div>
                    </div>
                </section>

                <!-- 搜索结果 -->
                <section class="px-4 py-4">
                    <div class="flex items-center justify-between mb-3">
                        <span id="resultCount" class="text-sm text-gray-600">找到 <span class="text-black font-medium">128</span> 个相关商品</span>
                        <div class="flex items-center space-x-2">
                            <select id="sortSelect" class="text-xs text-gray-500 bg-transparent border-none outline-none">
                                <option value="comprehensive">综合排序</option>
                                <option value="price-asc">价格从低到高</option>
                                <option value="price-desc">价格从高到低</option>
                                <option value="sales">销量优先</option>
                                <option value="rating">好评优先</option>
                                <option value="newest">最新上架</option>
                            </select>
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400">
                                <path d="m7 15 5 5 5-5"></path>
                                <path d="m7 9 5-5 5 5"></path>
                            </svg>
                        </div>
                    </div>

                    <!-- 无搜索结果状态 -->
                    <div id="noResultsState" class="text-center py-12 hidden">
                        <div class="text-gray-400 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.3-4.3"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">未找到相关商品</h3>
                        <p class="text-sm text-gray-500 mb-6">试试其他关键词或浏览推荐商品</p>

                        <!-- 搜索建议 -->
                        <div class="text-left bg-gray-50 rounded-lg p-4 mb-4">
                            <h4 class="text-sm font-medium mb-3">搜索建议:</h4>
                            <div class="space-y-2 text-sm text-gray-600">
                                <p>• 检查关键词拼写是否正确</p>
                                <p>• 尝试使用更通用的关键词</p>
                                <p>• 减少关键词数量</p>
                                <p>• 使用同义词或相关词汇</p>
                            </div>
                        </div>

                        <!-- 推荐搜索 -->
                        <div>
                            <h4 class="text-sm font-medium mb-3">推荐搜索:</h4>
                            <div class="flex flex-wrap gap-2 justify-center">
                                <button class="recommended-search px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-sm" data-keyword="智能门锁">智能门锁</button>
                                <button class="recommended-search px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-sm" data-keyword="智能摄像头">智能摄像头</button>
                                <button class="recommended-search px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-sm" data-keyword="智能开关">智能开关</button>
                                <button class="recommended-search px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-sm" data-keyword="智能音箱">智能音箱</button>
                            </div>
                        </div>
                    </div>

                    <!-- 搜索结果列表 -->
                    <div id="searchResultsList">

                    <!-- 商品列表 -->
                    <div class="grid grid-cols-2 gap-3">
                        <!-- 商品1 -->
                        <div class="product-card bg-white border border-gray-100 rounded-lg overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80" alt="智能门锁" class="w-full h-32 object-cover">
                            <div class="p-3">
                                <h3 class="text-sm font-medium mb-1 line-clamp-2">小米智能门锁Pro 指纹密码NFC</h3>
                                <div class="flex items-center space-x-1 mb-2">
                                    <span class="text-lg font-bold text-red-500">¥1299</span>
                                    <span class="text-xs text-gray-400 line-through">¥1599</span>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>已售2.3万</span>
                                    <div class="flex items-center">
                                        <span class="text-yellow-400">★</span>
                                        <span>4.8</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 商品2 -->
                        <div class="product-card bg-white border border-gray-100 rounded-lg overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80" alt="智能门锁" class="w-full h-32 object-cover">
                            <div class="p-3">
                                <h3 class="text-sm font-medium mb-1 line-clamp-2">德施曼智能门锁 全自动推拉</h3>
                                <div class="flex items-center space-x-1 mb-2">
                                    <span class="text-lg font-bold text-red-500">¥2199</span>
                                    <span class="text-xs text-gray-400 line-through">¥2699</span>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>已售1.8万</span>
                                    <div class="flex items-center">
                                        <span class="text-yellow-400">★</span>
                                        <span>4.9</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 商品3 -->
                        <div class="product-card bg-white border border-gray-100 rounded-lg overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80" alt="智能门锁" class="w-full h-32 object-cover">
                            <div class="p-3">
                                <h3 class="text-sm font-medium mb-1 line-clamp-2">凯迪仕智能门锁 人脸识别</h3>
                                <div class="flex items-center space-x-1 mb-2">
                                    <span class="text-lg font-bold text-red-500">¥1899</span>
                                    <span class="text-xs text-gray-400 line-through">¥2299</span>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>已售1.2万</span>
                                    <div class="flex items-center">
                                        <span class="text-yellow-400">★</span>
                                        <span>4.7</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 商品4 -->
                        <div class="product-card bg-white border border-gray-100 rounded-lg overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80" alt="智能门锁" class="w-full h-32 object-cover">
                            <div class="p-3">
                                <h3 class="text-sm font-medium mb-1 line-clamp-2">华为智能门锁 3D人脸识别</h3>
                                <div class="flex items-center space-x-1 mb-2">
                                    <span class="text-lg font-bold text-red-500">¥1699</span>
                                    <span class="text-xs text-gray-400 line-through">¥1999</span>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>已售8900</span>
                                    <div class="flex items-center">
                                        <span class="text-yellow-400">★</span>
                                        <span>4.6</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 商品5 -->
                        <div class="product-card bg-white border border-gray-100 rounded-lg overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80" alt="智能门锁" class="w-full h-32 object-cover">
                            <div class="p-3">
                                <h3 class="text-sm font-medium mb-1 line-clamp-2">鹿客智能门锁 指静脉识别</h3>
                                <div class="flex items-center space-x-1 mb-2">
                                    <span class="text-lg font-bold text-red-500">¥2599</span>
                                    <span class="text-xs text-gray-400 line-through">¥2999</span>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>已售6700</span>
                                    <div class="flex items-center">
                                        <span class="text-yellow-400">★</span>
                                        <span>4.8</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 商品6 -->
                        <div class="product-card bg-white border border-gray-100 rounded-lg overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80" alt="智能门锁" class="w-full h-32 object-cover">
                            <div class="p-3">
                                <h3 class="text-sm font-medium mb-1 line-clamp-2">TCL智能门锁 猫眼可视对讲</h3>
                                <div class="flex items-center space-x-1 mb-2">
                                    <span class="text-lg font-bold text-red-500">¥999</span>
                                    <span class="text-xs text-gray-400 line-through">¥1299</span>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span>已售5400</span>
                                    <div class="flex items-center">
                                        <span class="text-yellow-400">★</span>
                                        <span>4.5</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 加载更多 -->
                    <div class="text-center mt-6">
                        <button class="text-sm text-gray-500 py-2">加载更多商品...</button>
                    </div>
                </section>
            </div>

            <!-- 底部导航栏 -->
<div class="absolute bottom-0 left-0 right-0 h-[84px] bg-white/80 backdrop-blur-xl border-t border-white/20">
<!-- 导航栏内容 -->
<nav class="h-[49px] flex items-center px-2">
<div class="flex justify-around w-full text-[12px]">
<a class="flex flex-col items-center group text-gray-400 hover:text-gray-600 active:text-gray-800 transition-colors" href="home.html">
<div class="transform transition-transform group-hover:scale-110 group-active:scale-95">
<svg class="w-[22px] h-[22px] stroke-[1.5]" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
</div>
<span class="mt-1">首页</span>
</a>
<a class="flex flex-col items-center group text-gray-400 hover:text-gray-600 active:text-gray-800 transition-colors" href="design-result.html">
<div class="transform transition-transform group-hover:scale-110 group-active:scale-95">
<svg class="w-[22px] h-[22px] stroke-[1.5]" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<circle cx="13.5" cy="6.5" fill="currentColor" r=".5"></circle>
<circle cx="17.5" cy="10.5" fill="currentColor" r=".5"></circle>
<circle cx="8.5" cy="7.5" fill="currentColor" r=".5"></circle>
<circle cx="6.5" cy="12.5" fill="currentColor" r=".5"></circle>
<path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path>
</svg>
</div>
<span class="mt-1">设计</span>
</a>
<a class="flex flex-col items-center group text-black transition-colors" href="mall.html" class="flex flex-col items-center group text-black transition-colors">
<div class="transform transition-transform group-hover:scale-110 group-active:scale-95">
<svg class="w-[22px] h-[22px] stroke-[1.5]" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
<path d="M3 6h18"></path>
<path d="M16 10a4 4 0 0 1-8 0"></path>
</svg>
</div>
<span class="mt-1">商城</span>
</a>
<a class="flex flex-col items-center group text-gray-400 hover:text-gray-600 active:text-gray-800 transition-colors" href="spaces.html">
<div class="transform transition-transform group-hover:scale-110 group-active:scale-95">
<svg class="w-[22px] h-[22px] stroke-[1.5]" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9"></path>
<path d="m18 15 4-4"></path>
<path d="m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5"></path>
</svg>
</div>
<span class="mt-1">施工</span>
</a>
<a class="flex flex-col items-center group text-gray-400 hover:text-gray-600 active:text-gray-800 transition-colors" href="me.html">
<div class="transform transition-transform group-hover:scale-110 group-active:scale-95">
<svg class="w-[22px] h-[22px] stroke-[1.5]" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
<circle cx="12" cy="7" r="4"></circle>
</svg>
</div>
<span class="mt-1">我的</span>
</a>
</div>
</nav>
<!-- iPhone 16 Home Indicator -->
<div class="h-[34px] flex items-center justify-center">
<div class="w-[134px] h-[5px] bg-black rounded-full"></div>
</div>
</div>
            </div>
        </div>
    </div>

    <script>
        // 商城搜索页面管理器
        class MallSearchPageManager {
            constructor() {
                this.currentQuery = '';
                this.searchHistory = this.getSearchHistory();
                this.hotSearches = ['智能门锁', '智能摄像头', '智能开关', '智能音箱', '智能灯泡', '传感器'];
                this.activeFilters = {
                    sort: 'comprehensive',
                    quickFilter: 'all'
                };
                this.mockProducts = this.generateMockProducts();
                this.init();
            }

            init() {
                this.loadQueryFromURL();
                this.initSearchInput();
                this.initSearchHistory();
                this.initQuickFilters();
                this.initSortSelect();
                this.initRecommendedSearch();
                this.performInitialSearch();
            }

            // 从URL获取搜索查询
            loadQueryFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                this.currentQuery = urlParams.get('q') || '';
                if (this.currentQuery) {
                    document.getElementById('searchInput').value = this.currentQuery;
                    this.saveSearchHistory(this.currentQuery);
                }
            }

            // 初始化搜索输入框
            initSearchInput() {
                const searchInput = document.getElementById('searchInput');
                const clearSearch = document.getElementById('clearSearch');

                // 监听输入变化
                searchInput.addEventListener('input', (e) => {
                    const value = e.target.value;
                    if (value) {
                        clearSearch.classList.remove('hidden');
                    } else {
                        clearSearch.classList.add('hidden');
                    }
                });

                // 清除搜索
                clearSearch.addEventListener('click', () => {
                    searchInput.value = '';
                    clearSearch.classList.add('hidden');
                    searchInput.focus();
                });

                // 回车搜索
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch(searchInput.value.trim());
                    }
                });

                // 显示清除按钮
                if (searchInput.value) {
                    clearSearch.classList.remove('hidden');
                }
            }

            // 初始化搜索历史
            initSearchHistory() {
                const clearHistory = document.getElementById('clearHistory');

                clearHistory.addEventListener('click', () => {
                    this.clearSearchHistory();
                    this.renderSearchTags();
                });

                this.renderSearchTags();
            }

            // 渲染搜索标签
            renderSearchTags() {
                const searchTags = document.getElementById('searchTags');
                const historyTitle = document.getElementById('historyTitle');

                let tags = [];

                if (this.searchHistory.length > 0) {
                    historyTitle.textContent = '搜索历史';
                    tags = this.searchHistory.slice(0, 6);
                } else {
                    historyTitle.textContent = '热门搜索';
                    tags = this.hotSearches.slice(0, 6);
                }

                searchTags.innerHTML = tags.map(tag => `
                    <button class="search-tag px-3 py-1 bg-gray-100 rounded-full text-sm hover:bg-gray-200 transition-colors" data-keyword="${tag}">
                        ${tag}
                    </button>
                `).join('');

                // 添加点击事件
                searchTags.querySelectorAll('.search-tag').forEach(tag => {
                    tag.addEventListener('click', () => {
                        const keyword = tag.dataset.keyword;
                        document.getElementById('searchInput').value = keyword;
                        this.performSearch(keyword);
                    });
                });
            }

            // 初始化快速筛选
            initQuickFilters() {
                const quickFilterBtns = document.querySelectorAll('.quick-filter-btn');
                const moreFilters = document.getElementById('moreFilters');

                quickFilterBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        quickFilterBtns.forEach(b => b.classList.remove('active', 'bg-black', 'text-white'));
                        btn.classList.add('active', 'bg-black', 'text-white');

                        this.activeFilters.quickFilter = btn.dataset.filter;
                        this.applyFilters();
                    });
                });

                // 更多筛选按钮
                moreFilters.addEventListener('click', () => {
                    alert('高级筛选功能开发中...');
                });
            }

            // 初始化排序选择
            initSortSelect() {
                const sortSelect = document.getElementById('sortSelect');

                sortSelect.addEventListener('change', () => {
                    this.activeFilters.sort = sortSelect.value;
                    this.applyFilters();
                });
            }

            // 初始化推荐搜索
            initRecommendedSearch() {
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('recommended-search')) {
                        const keyword = e.target.dataset.keyword;
                        document.getElementById('searchInput').value = keyword;
                        this.performSearch(keyword);
                    }
                });
            }

            // 执行搜索
            performSearch(query) {
                if (!query) return;

                this.currentQuery = query;
                this.saveSearchHistory(query);
                this.renderSearchTags();

                // 更新URL
                const newUrl = new URL(window.location);
                newUrl.searchParams.set('q', query);
                window.history.replaceState({}, '', newUrl);

                this.searchProducts(query);
            }

            // 执行初始搜索
            performInitialSearch() {
                if (this.currentQuery) {
                    this.searchProducts(this.currentQuery);
                } else {
                    this.showAllProducts();
                }
            }

            // 搜索商品
            searchProducts(query) {
                const results = this.mockProducts.filter(product =>
                    product.name.toLowerCase().includes(query.toLowerCase()) ||
                    product.brand.toLowerCase().includes(query.toLowerCase()) ||
                    product.category.toLowerCase().includes(query.toLowerCase())
                );

                this.displaySearchResults(results, query);
            }

            // 显示所有商品
            showAllProducts() {
                this.displaySearchResults(this.mockProducts, '');
            }

            // 显示搜索结果
            displaySearchResults(products, query) {
                const resultCount = document.getElementById('resultCount');
                const noResultsState = document.getElementById('noResultsState');
                const searchResultsList = document.getElementById('searchResultsList');

                if (products.length === 0) {
                    // 显示无结果状态
                    resultCount.innerHTML = `未找到 "<span class="text-black font-medium">${query}</span>" 的相关商品`;
                    noResultsState.classList.remove('hidden');
                    searchResultsList.innerHTML = '';
                } else {
                    // 显示搜索结果
                    resultCount.innerHTML = `找到 <span class="text-black font-medium">${products.length}</span> 个相关商品`;
                    noResultsState.classList.add('hidden');

                    // 应用排序
                    const sortedProducts = this.sortProducts(products);

                    searchResultsList.innerHTML = `
                        <div class="grid grid-cols-2 gap-3">
                            ${sortedProducts.map(product => this.renderProductCard(product)).join('')}
                        </div>
                        <div class="text-center mt-6">
                            <button class="text-sm text-gray-500 py-2">加载更多商品...</button>
                        </div>
                    `;
                }
            }

            // 排序商品
            sortProducts(products) {
                const sorted = [...products];

                switch (this.activeFilters.sort) {
                    case 'price-asc':
                        return sorted.sort((a, b) => a.price - b.price);
                    case 'price-desc':
                        return sorted.sort((a, b) => b.price - a.price);
                    case 'sales':
                        return sorted.sort((a, b) => b.sales - a.sales);
                    case 'rating':
                        return sorted.sort((a, b) => b.rating - a.rating);
                    case 'newest':
                        return sorted.sort((a, b) => new Date(b.createTime) - new Date(a.createTime));
                    default:
                        return sorted;
                }
            }

            // 应用筛选
            applyFilters() {
                if (this.currentQuery) {
                    this.searchProducts(this.currentQuery);
                } else {
                    this.showAllProducts();
                }
            }

            // 渲染商品卡片
            renderProductCard(product) {
                const discountPercent = Math.round((1 - product.price / product.originalPrice) * 100);

                return `
                    <div class="product-card bg-white border border-gray-100 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-32 object-cover">
                        <div class="p-3">
                            <h3 class="text-sm font-medium mb-1 line-clamp-2">${product.name}</h3>
                            <div class="flex items-center space-x-1 mb-2">
                                <span class="text-lg font-bold text-red-500">¥${product.price}</span>
                                ${product.originalPrice > product.price ? `
                                    <span class="text-xs text-gray-400 line-through">¥${product.originalPrice}</span>
                                    <span class="text-xs bg-red-100 text-red-600 px-1 rounded">${discountPercent}%</span>
                                ` : ''}
                            </div>
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>已售${this.formatSales(product.sales)}</span>
                                <div class="flex items-center">
                                    <span class="text-yellow-400">★</span>
                                    <span>${product.rating}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // 格式化销量
            formatSales(sales) {
                if (sales >= 10000) {
                    return (sales / 10000).toFixed(1) + '万';
                }
                return sales.toString();
            }

            // 生成模拟商品数据
            generateMockProducts() {
                return [
                    {
                        id: 1,
                        name: '小米智能门锁Pro 指纹密码NFC',
                        brand: '小米',
                        category: '智能门锁',
                        price: 1299,
                        originalPrice: 1599,
                        sales: 23000,
                        rating: 4.8,
                        image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80',
                        createTime: '2024-01-15'
                    },
                    {
                        id: 2,
                        name: '德施曼智能门锁 全自动推拉',
                        brand: '德施曼',
                        category: '智能门锁',
                        price: 2199,
                        originalPrice: 2699,
                        sales: 18000,
                        rating: 4.9,
                        image: 'https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80',
                        createTime: '2024-01-10'
                    },
                    {
                        id: 3,
                        name: '华为智能摄像头 3D人脸识别',
                        brand: '华为',
                        category: '智能摄像头',
                        price: 399,
                        originalPrice: 499,
                        sales: 15600,
                        rating: 4.7,
                        image: 'https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80',
                        createTime: '2024-01-12'
                    },
                    {
                        id: 4,
                        name: 'Aqara智能开关 无线遥控',
                        brand: 'Aqara',
                        category: '智能开关',
                        price: 89,
                        originalPrice: 129,
                        sales: 32000,
                        rating: 4.6,
                        image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80',
                        createTime: '2024-01-08'
                    },
                    {
                        id: 5,
                        name: '小米智能音箱 语音控制',
                        brand: '小米',
                        category: '智能音箱',
                        price: 199,
                        originalPrice: 299,
                        sales: 45000,
                        rating: 4.5,
                        image: 'https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80',
                        createTime: '2024-01-05'
                    },
                    {
                        id: 6,
                        name: 'Yeelight智能灯泡 调色温',
                        brand: 'Yeelight',
                        category: '智能灯泡',
                        price: 59,
                        originalPrice: 79,
                        sales: 28000,
                        rating: 4.4,
                        image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=150&q=80',
                        createTime: '2024-01-03'
                    }
                ];
            }

            // 搜索历史管理
            getSearchHistory() {
                return JSON.parse(localStorage.getItem('mallSearchHistory') || '[]');
            }

            saveSearchHistory(query) {
                let history = this.getSearchHistory();
                history = history.filter(item => item !== query);
                history.unshift(query);
                history = history.slice(0, 10);
                localStorage.setItem('mallSearchHistory', JSON.stringify(history));
                this.searchHistory = history;
            }

            clearSearchHistory() {
                localStorage.removeItem('mallSearchHistory');
                this.searchHistory = [];
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            new MallSearchPageManager();
        });
    </script>
</body>
</html>
