<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H5Bridgeé›†æˆçŠ¶æ€æ£€æŸ¥ - æ™ºèƒ½è®¾è®¡ä¸æ–½å·¥å¹³å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-card {
            transition: all 0.3s ease;
        }
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-integrated { background: #10b981; }
        .status-partial { background: #f59e0b; }
        .status-pending { background: #ef4444; }
        
        .feature-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin: 1px;
        }
        .feature-payment { background: #fee2e2; color: #dc2626; }
        .feature-share { background: #dbeafe; color: #2563eb; }
        .feature-userinfo { background: #d1fae5; color: #059669; }
        .feature-location { background: #fef3c7; color: #d97706; }
        .feature-navigation { background: #e0e7ff; color: #5b21b6; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold mb-4">H5Bridgeé›†æˆçŠ¶æ€æ£€æŸ¥</h1>
            <p class="text-gray-600">æ£€æŸ¥æ‰€æœ‰é¡µé¢çš„å°ç¨‹åºé€šä¿¡åŠŸèƒ½é›†æˆçŠ¶æ€</p>
        </div>

        <!-- æ€»ä½“ç»Ÿè®¡ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg p-6 text-center shadow-sm">
                <div class="text-3xl font-bold text-blue-600" id="totalPages">57</div>
                <div class="text-sm text-gray-500">æ€»é¡µé¢æ•°</div>
            </div>
            <div class="bg-white rounded-lg p-6 text-center shadow-sm">
                <div class="text-3xl font-bold text-green-600" id="integratedPages">0</div>
                <div class="text-sm text-gray-500">å·²é›†æˆ</div>
            </div>
            <div class="bg-white rounded-lg p-6 text-center shadow-sm">
                <div class="text-3xl font-bold text-yellow-600" id="partialPages">0</div>
                <div class="text-sm text-gray-500">éƒ¨åˆ†é›†æˆ</div>
            </div>
            <div class="bg-white rounded-lg p-6 text-center shadow-sm">
                <div class="text-3xl font-bold text-red-600" id="pendingPages">57</div>
                <div class="text-sm text-gray-500">å¾…é›†æˆ</div>
            </div>
        </div>

        <!-- åŠŸèƒ½ç»Ÿè®¡ -->
        <div class="bg-white rounded-lg p-6 mb-8 shadow-sm">
            <h3 class="text-lg font-semibold mb-4">åŠŸèƒ½é›†æˆç»Ÿè®¡</h3>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600" id="navigationCount">0</div>
                    <div class="text-sm text-gray-500">é¡µé¢å¯¼èˆª</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-red-600" id="paymentCount">0</div>
                    <div class="text-sm text-gray-500">æ”¯ä»˜åŠŸèƒ½</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600" id="shareCount">0</div>
                    <div class="text-sm text-gray-500">åˆ†äº«åŠŸèƒ½</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="userInfoCount">0</div>
                    <div class="text-sm text-gray-500">ç”¨æˆ·ä¿¡æ¯</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-yellow-600" id="locationCount">0</div>
                    <div class="text-sm text-gray-500">ä½ç½®æœåŠ¡</div>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="text-center mb-8">
            <div class="space-x-4">
                <button onclick="checkAllPages()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors">
                    ğŸ” æ£€æŸ¥é›†æˆçŠ¶æ€
                </button>
                <button onclick="testMiniProgramFeatures()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors">
                    ğŸ“± æµ‹è¯•å°ç¨‹åºåŠŸèƒ½
                </button>
                <button onclick="generateIntegrationReport()" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors">
                    ğŸ“Š ç”Ÿæˆé›†æˆæŠ¥å‘Š
                </button>
            </div>
        </div>

        <!-- é¡µé¢åˆ—è¡¨ -->
        <div class="bg-white rounded-lg shadow-sm">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold">é¡µé¢é›†æˆçŠ¶æ€è¯¦æƒ…</h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="pagesList">
                    <!-- é¡µé¢å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- é›†æˆæŒ‡å— -->
        <div class="mt-8 bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold mb-4">é›†æˆçŠ¶æ€è¯´æ˜</h3>
            <div class="space-y-3 text-sm">
                <div class="flex items-start">
                    <span class="status-indicator status-integrated mr-2 mt-1"></span>
                    <div>
                        <strong>å·²å®Œå…¨é›†æˆ</strong> - åŒ…å«H5Bridgeè„šæœ¬ï¼Œæ”¯æŒé¡µé¢å¯¼èˆªã€ç”¨æˆ·ä¿¡æ¯ç­‰åŸºç¡€åŠŸèƒ½
                    </div>
                </div>
                <div class="flex items-start">
                    <span class="status-indicator status-partial mr-2 mt-1"></span>
                    <div>
                        <strong>éƒ¨åˆ†é›†æˆ</strong> - åŒ…å«éƒ¨åˆ†å°ç¨‹åºåŠŸèƒ½ï¼Œä½†å¯èƒ½ç¼ºå°‘æŸäº›ç‰¹å®šåŠŸèƒ½
                    </div>
                </div>
                <div class="flex items-start">
                    <span class="status-indicator status-pending mr-2 mt-1"></span>
                    <div>
                        <strong>å¾…é›†æˆ</strong> - å°šæœªé›†æˆH5Bridgeé€šä¿¡åŠŸèƒ½
                    </div>
                </div>
            </div>
            
            <div class="mt-6">
                <h4 class="font-semibold mb-2">åŠŸèƒ½æ ‡è¯†è¯´æ˜</h4>
                <div class="flex flex-wrap gap-2">
                    <span class="feature-badge feature-navigation">å¯¼èˆª</span>
                    <span class="feature-badge feature-payment">æ”¯ä»˜</span>
                    <span class="feature-badge feature-share">åˆ†äº«</span>
                    <span class="feature-badge feature-userinfo">ç”¨æˆ·ä¿¡æ¯</span>
                    <span class="feature-badge feature-location">ä½ç½®</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢é…ç½®
        const pageConfigs = {
            'home.html': { name: 'é¦–é¡µ', priority: 'high', expectedFeatures: ['navigation', 'share', 'userinfo'] },
            'mall.html': { name: 'å•†åŸ', priority: 'high', expectedFeatures: ['navigation', 'userinfo', 'location'] },
            'design-result.html': { name: 'è®¾è®¡ç»“æœ', priority: 'high', expectedFeatures: ['navigation', 'share'] },
            'spaces.html': { name: 'æ–½å·¥ç©ºé—´', priority: 'high', expectedFeatures: ['navigation', 'userinfo'] },
            'me.html': { name: 'ä¸ªäººä¸­å¿ƒ', priority: 'high', expectedFeatures: ['navigation', 'userinfo', 'share'] },
            'design-payment.html': { name: 'è®¾è®¡ä»˜æ¬¾', priority: 'high', expectedFeatures: ['navigation', 'payment', 'userinfo'] },
            'mall-cart.html': { name: 'è´­ç‰©è½¦', priority: 'high', expectedFeatures: ['navigation', 'payment', 'userinfo'] },
            'order-confirm.html': { name: 'è®¢å•ç¡®è®¤', priority: 'high', expectedFeatures: ['navigation', 'payment', 'userinfo'] },
            'login.html': { name: 'ç™»å½•', priority: 'medium', expectedFeatures: ['navigation', 'userinfo'] },
            'register.html': { name: 'æ³¨å†Œ', priority: 'medium', expectedFeatures: ['navigation', 'userinfo'] }
        };

        let integrationStatus = {};
        let featureCounts = {
            navigation: 0,
            payment: 0,
            share: 0,
            userinfo: 0,
            location: 0
        };

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            generatePagesList();
            checkAllPages();
        }

        // ç”Ÿæˆé¡µé¢åˆ—è¡¨
        function generatePagesList() {
            const container = document.getElementById('pagesList');
            
            // è·å–æ‰€æœ‰HTMLæ–‡ä»¶
            const allPages = [
                'home.html', 'design-result.html', 'mall.html', 'spaces.html', 'me.html',
                'design-payment.html', 'mall-cart.html', 'order-confirm.html', 'login.html', 'register.html',
                'design-service-detail.html', 'design-project-detail.html', 'design-history.html', 'design-budget.html',
                'mall-detail.html', 'mall-search.html', 'mall-order.html', 'construction-projects.html',
                'my-projects.html', 'optimized_knowledge.html', 'ai-assistant.html', 'messages.html'
                // ... å…¶ä»–é¡µé¢
            ];
            
            allPages.forEach(page => {
                const config = pageConfigs[page] || { 
                    name: page.replace('.html', '').replace(/-/g, ' '), 
                    priority: 'low', 
                    expectedFeatures: ['navigation'] 
                };
                
                const card = document.createElement('div');
                card.className = 'status-card border border-gray-200 rounded-lg p-4';
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium">${config.name}</span>
                        <span class="status-indicator status-pending" id="status-${page}"></span>
                    </div>
                    <div class="text-xs text-gray-500 mb-2">${page}</div>
                    <div class="text-xs mb-2">
                        <span class="px-2 py-1 rounded ${config.priority === 'high' ? 'bg-red-100 text-red-800' : config.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'}">
                            ${config.priority === 'high' ? 'é«˜ä¼˜å…ˆçº§' : config.priority === 'medium' ? 'ä¸­ä¼˜å…ˆçº§' : 'ä½ä¼˜å…ˆçº§'}
                        </span>
                    </div>
                    <div class="features" id="features-${page}">
                        ${config.expectedFeatures.map(feature => 
                            `<span class="feature-badge feature-${feature}">${getFeatureName(feature)}</span>`
                        ).join('')}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // è·å–åŠŸèƒ½åç§°
        function getFeatureName(feature) {
            const names = {
                navigation: 'å¯¼èˆª',
                payment: 'æ”¯ä»˜',
                share: 'åˆ†äº«',
                userinfo: 'ç”¨æˆ·ä¿¡æ¯',
                location: 'ä½ç½®'
            };
            return names[feature] || feature;
        }

        // æ£€æŸ¥æ‰€æœ‰é¡µé¢
        async function checkAllPages() {
            let integrated = 0;
            let partial = 0;
            let pending = 0;
            
            // é‡ç½®åŠŸèƒ½è®¡æ•°
            featureCounts = {
                navigation: 0,
                payment: 0,
                share: 0,
                userinfo: 0,
                location: 0
            };

            const allPages = Object.keys(pageConfigs);
            
            for (const page of allPages) {
                try {
                    const response = await fetch(page);
                    const content = await response.text();
                    
                    let status = 'pending';
                    let features = [];
                    let score = 0;
                    
                    // æ£€æŸ¥H5Bridgeé›†æˆ
                    if (content.includes('js/h5-bridge.js')) {
                        score += 2;
                        features.push('navigation');
                        featureCounts.navigation++;
                    }
                    
                    // æ£€æŸ¥å„é¡¹åŠŸèƒ½
                    if (content.includes('handleMiniProgramPayment') || content.includes('requestPayment')) {
                        score += 1;
                        features.push('payment');
                        featureCounts.payment++;
                    }
                    
                    if (content.includes('handleMiniProgramShare') || content.includes('share')) {
                        score += 1;
                        features.push('share');
                        featureCounts.share++;
                    }
                    
                    if (content.includes('getUserInfo') || content.includes('updateUserDisplay')) {
                        score += 1;
                        features.push('userinfo');
                        featureCounts.userinfo++;
                    }
                    
                    if (content.includes('getLocation') || content.includes('location')) {
                        score += 1;
                        features.push('location');
                        featureCounts.location++;
                    }
                    
                    // ç¡®å®šçŠ¶æ€
                    if (score >= 3) {
                        status = 'integrated';
                        integrated++;
                    } else if (score >= 1) {
                        status = 'partial';
                        partial++;
                    } else {
                        pending++;
                    }
                    
                    integrationStatus[page] = { status, score, features };
                    updatePageStatus(page, status);
                    
                } catch (error) {
                    pending++;
                    integrationStatus[page] = { status: 'pending', score: 0, features: [] };
                    updatePageStatus(page, 'pending');
                }
            }

            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('integratedPages').textContent = integrated;
            document.getElementById('partialPages').textContent = partial;
            document.getElementById('pendingPages').textContent = pending;
            
            // æ›´æ–°åŠŸèƒ½ç»Ÿè®¡
            document.getElementById('navigationCount').textContent = featureCounts.navigation;
            document.getElementById('paymentCount').textContent = featureCounts.payment;
            document.getElementById('shareCount').textContent = featureCounts.share;
            document.getElementById('userInfoCount').textContent = featureCounts.userinfo;
            document.getElementById('locationCount').textContent = featureCounts.location;
        }

        // æ›´æ–°é¡µé¢çŠ¶æ€
        function updatePageStatus(filename, status) {
            const indicator = document.getElementById(`status-${filename}`);
            if (indicator) {
                indicator.className = `status-indicator status-${status}`;
            }
        }

        // æµ‹è¯•å°ç¨‹åºåŠŸèƒ½
        function testMiniProgramFeatures() {
            if (window.H5Bridge) {
                alert(`å°ç¨‹åºç¯å¢ƒæ£€æµ‹ï¼š${window.H5Bridge.isInMiniProgram ? 'âœ… åœ¨å°ç¨‹åºä¸­' : 'âŒ åœ¨æµè§ˆå™¨ä¸­'}\n\nå¯ç”¨åŠŸèƒ½æµ‹è¯•ï¼š\n- é¡µé¢å¯¼èˆªï¼š${window.H5Bridge.isSupported('navigate') ? 'âœ…' : 'âŒ'}\n- æ”¯ä»˜åŠŸèƒ½ï¼š${window.H5Bridge.isSupported('payment') ? 'âœ…' : 'âŒ'}\n- åˆ†äº«åŠŸèƒ½ï¼š${window.H5Bridge.isSupported('share') ? 'âœ…' : 'âŒ'}\n- ç”¨æˆ·ä¿¡æ¯ï¼š${window.H5Bridge.isSupported('userInfo') ? 'âœ…' : 'âŒ'}`);
            } else {
                alert('âŒ H5BridgeæœªåŠ è½½ï¼Œè¯·ç¡®ä¿å½“å‰é¡µé¢å·²é›†æˆH5Bridge');
            }
        }

        // ç”Ÿæˆé›†æˆæŠ¥å‘Š
        function generateIntegrationReport() {
            let report = "# H5Bridgeé›†æˆçŠ¶æ€æŠ¥å‘Š\n\n";
            
            report += `## æ€»ä½“ç»Ÿè®¡\n`;
            report += `- æ€»é¡µé¢æ•°: ${Object.keys(pageConfigs).length}\n`;
            report += `- å·²å®Œå…¨é›†æˆ: ${document.getElementById('integratedPages').textContent}\n`;
            report += `- éƒ¨åˆ†é›†æˆ: ${document.getElementById('partialPages').textContent}\n`;
            report += `- å¾…é›†æˆ: ${document.getElementById('pendingPages').textContent}\n\n`;
            
            report += `## åŠŸèƒ½ç»Ÿè®¡\n`;
            report += `- é¡µé¢å¯¼èˆª: ${featureCounts.navigation}\n`;
            report += `- æ”¯ä»˜åŠŸèƒ½: ${featureCounts.payment}\n`;
            report += `- åˆ†äº«åŠŸèƒ½: ${featureCounts.share}\n`;
            report += `- ç”¨æˆ·ä¿¡æ¯: ${featureCounts.userinfo}\n`;
            report += `- ä½ç½®æœåŠ¡: ${featureCounts.location}\n\n`;
            
            report += `## é¡µé¢è¯¦æƒ…\n`;
            for (const [page, status] of Object.entries(integrationStatus)) {
                const config = pageConfigs[page];
                const statusText = {
                    'integrated': 'âœ… å·²å®Œå…¨é›†æˆ',
                    'partial': 'âš ï¸ éƒ¨åˆ†é›†æˆ',
                    'pending': 'âŒ å¾…é›†æˆ'
                }[status.status];
                
                report += `### ${config.name} (${page})\n`;
                report += `- çŠ¶æ€: ${statusText}\n`;
                report += `- é›†æˆåˆ†æ•°: ${status.score}/5\n`;
                report += `- å·²é›†æˆåŠŸèƒ½: ${status.features.join(', ')}\n\n`;
            }
            
            // ä¸‹è½½æŠ¥å‘Š
            const blob = new Blob([report], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'h5bridge-integration-report.md';
            a.click();
            URL.revokeObjectURL(url);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
    
    <!-- H5Bridgeå°ç¨‹åºé€šä¿¡ -->
    <script src="js/h5-bridge.js"></script>
</body>
</html>
